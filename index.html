<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>LIXY Store Premium 2.0 â€“ Minimalist</title>

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">

<style>
/* ROOT + GLOBAL THEME */
:root{
  --bg:#0f0f0f;
  --bg2:#151515;
  --card:#1c1c1c;
  --card2:#222;
  --text:#fff;
  --muted:#bfbfbf;
  --accent:#39ffb4;
  --accent-dark:#00c985;
  --line:#2a2a2a;
  --radius:14px;
  --shadow:0 8px 24px rgba(0,0,0,.4);
}

body{
  margin:0;
  background:var(--bg);
  color:var(--text);
  font-family:Poppins,sans-serif;
  -webkit-tap-highlight-color:transparent;
}

.hidden{display:none!important;}
button{font-family:inherit;cursor:pointer;}

/* SPLASH */
#splash{
  height:100vh;display:flex;flex-direction:column;justify-content:center;align-items:center;
  text-align:center;padding:20px;
}
.splash-card{
  background:var(--card);padding:30px 20px;border-radius:20px;border:1px solid var(--line);
  width:min(420px,100%);box-shadow:var(--shadow);
}
.logo{width:150px;height:150px;border-radius:50%;overflow:hidden;margin:0 auto 16px;border:3px solid #fff;}
.logo img{width:100%;height:100%;object-fit:cover;}
.btn{
  width:100%;padding:12px;background:var(--accent);border:none;border-radius:12px;
  color:#000;font-weight:800;margin-top:12px;font-size:16px;
}
.btn.secondary{
  background:var(--card2);color:#fff;border:1px solid var(--line);
}

/* HEADER */
header{
  padding:14px 16px;display:flex;justify-content:space-between;align-items:center;
  position:sticky;top:0;z-index:50;
  background:rgba(20,20,20,.8);backdrop-filter:blur(14px);border-bottom:1px solid var(--line);
}
header img{width:42px;height:42px;border-radius:50%;object-fit:cover;cursor:pointer;user-select:none;}
.head-title{font-weight:700;font-size:18px;}
.cart-mini{font-size:18px;cursor:pointer;position:relative;font-weight:700;}
.badge{
  position:absolute;top:-8px;right:-10px;background:#ff4444;color:#fff;border-radius:50%;
  font-size:11px;width:20px;height:20px;display:flex;align-items:center;justify-content:center;
  font-weight:800;border:2px solid var(--bg);
}

/* BRAND GRID */
.brand-grid{
  padding:20px;display:grid;grid-template-columns:repeat(auto-fit,minmax(140px,1fr));gap:16px;
}
.brand-item{
  background:var(--card);padding:18px;text-align:center;border-radius:var(--radius);
  border:1px solid var(--line);font-weight:700;cursor:pointer;transition:.2s;
}
.brand-item:hover{border-color:var(--accent);transform:translateY(-3px);}

/* SEARCH */
.search-wrap{
  position:sticky;top:70px;z-index:45;background:var(--bg);
  padding:10px 16px;border-bottom:1px solid var(--line);
}
.search{
  width:100%;padding:12px 14px;border-radius:12px;border:1px solid var(--line);
  background:var(--card);color:#fff;font-size:15px;
}

/* CATEGORY CHIPS */
.chips{
  display:flex;gap:10px;overflow-x:auto;padding:10px 16px;border-bottom:1px solid var(--line);
}
.chip{
  padding:8px 14px;border-radius:20px;background:var(--card);border:1px solid var(--line);
  font-size:13px;font-weight:600;cursor:pointer;white-space:nowrap;
}
.chip.active{background:var(--accent);border-color:var(--accent);color:#000;}

/* PRODUCT LIST */
#productList{padding:20px;}
.product-card{
  background:var(--card);border-radius:var(--radius);padding:12px;border:1px solid var(--line);
  transition:.2s;display:flex;gap:12px;
}
.product-card:hover{border-color:var(--accent);}
.product-card img{
  width:110px;height:110px;border-radius:12px;object-fit:cover;background:#000;flex-shrink:0;
}
.product-info{flex:1;min-width:0;}
.product-info h3{
  margin:0;font-size:16px;font-weight:700;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;
}
.product-info small{color:var(--muted);}
.add-btn{
  margin-top:8px;display:inline-block;padding:7px 12px;background:var(--accent);
  color:#000;border-radius:10px;font-weight:800;font-size:13px;cursor:pointer;text-align:center;
}

/* CART PAGE */
.cart-item{
  background:var(--card);padding:14px;border-radius:12px;border:1px solid var(--line);
  margin-bottom:12px;display:flex;justify-content:space-between;gap:10px;
}
.qty-btn{
  padding:4px 10px;background:var(--accent);border:none;border-radius:8px;font-weight:700;
}
.remove-btn{background:transparent;border:none;color:#ff5555;font-weight:700;cursor:pointer;}
.summary{padding:16px;}
.summary textarea,.summary select{
  width:100%;background:var(--card);border:1px solid var(--line);color:#fff;
  padding:10px;border-radius:10px;margin-top:8px;
}

/* FLOAT CART */
#floatCart{
  display:none;position:fixed;left:0;right:0;bottom:0;background:rgba(20,20,20,.9);
  backdrop-filter:blur(10px);border-top:1px solid var(--line);padding:10px 14px;z-index:50;
}
.float-inner{max-width:1100px;margin:0 auto;display:flex;justify-content:space-between;align-items:center;}
.float-btn{
  padding:8px 12px;background:var(--accent);border:none;border-radius:10px;color:#000;font-weight:800;
}

/* POPUP */
#popup{
  display:none;position:fixed;inset:0;background:rgba(0,0,0,.65);
  justify-content:center;align-items:center;padding:20px;z-index:100;
}
#popup .inner{
  background:var(--card2);padding:20px;border-radius:14px;width:min(420px,100%);
}

/* OPTION POPUP */
#optionPopup{
  display:none;position:fixed;inset:0;background:rgba(0,0,0,.55);
  justify-content:center;align-items:center;padding:20px;z-index:120;
}
.inner-opt{
  background:var(--card2);padding:18px;border-radius:14px;width:min(350px,100%);
}
.inner-opt select{
  width:100%;padding:10px;margin:6px 0;border-radius:10px;border:1px solid var(--line);
  background:var(--card);color:#fff;
}

</style>
</head>

<body>

<section id="splash">
  <div class="splash-card">
    <div class="logo"><img src="img/lglixystore.png"></div>
    <h2 style="margin:0;font-size:28px;font-weight:800;">LIXY STORE</h2>
    <p style="color:var(--muted);margin:6px 0 0;">coffee & tea marketplace</p>
    <button class="btn" onclick="goName()">Mulai</button>
  </div>
</section>

<section id="namePage" class="hidden" style="min-height:100vh;display:flex;justify-content:center;align-items:center;padding:20px;">
  <div style="width:min(520px,100%);text-align:center;">
    <h2>Masukkan Nama Kamu</h2>
    <input id="buyerName" class="search" placeholder="Nama lengkap..." maxlength="24"/>
    <button class="btn" onclick="saveName()">Lanjut</button>
  </div>
</section>

<section id="brandPage" class="hidden">
  <header>
    <img src="img/lglixystore.png" onclick="reloadBrand()">
    <div class="head-title" id="helloUser">LIXY Store</div>
    <div class="cart-mini" onclick="openCart()">ðŸ›’ Cart <span id="badge" class="badge hidden">0</span></div>
  </header>

  <div style="padding:16px 20px 0;">
    <h2>Pilih Brand</h2>
    <p style="color:var(--muted);font-size:14px;">Pilih brand favoritmu.</p>
  </div>

  <div class="brand-grid">
    <div class="brand-item" onclick="openBrand('fore')">Fore</div>
    <div class="brand-item" onclick="openBrand('kenangan')">Kopi Kenangan</div>
    <div class="brand-item" onclick="openBrand('janjijiwa')">Janji Jiwa</div>
    <div class="brand-item" onclick="openBrand('tomoro')">Tomoro</div>
    <div class="brand-item" onclick="openBrand('chagee')">Chagee</div>
  </div>
</section>

<section id="productPage" class="hidden">

  <header>
    <img src="img/lglixystore.png" onclick="backBrand()">
    <div class="head-title" id="brandTitle">Produk</div>
    <div class="cart-mini" onclick="openCart()">ðŸ›’ Cart <span id="badge2" class="badge hidden">0</span></div>
  </header>

  <div style="padding:10px 16px;color:var(--muted);font-size:14px;">
    Hi, <span id="helloUser2"></span> ðŸ‘‹
  </div>

  <div class="search-wrap">
    <input id="searchInput" class="search" placeholder="Cari menu..." oninput="onSearch(this.value)">
  </div>

  <div id="categoryChips" class="chips"></div>
  <div id="productList"></div>

</section>

<section id="cartPage" class="hidden">
  <header>
    <img src="img/lglixystore.png" onclick="backProduct()">
    <div class="head-title">Keranjang</div>
    <div></div>
  </header>

  <div style="padding:14px 16px 0;">
    <h2>Pesanan Kamu</h2>
    <p style="color:var(--muted);font-size:14px;">Cek dulu sebelum checkout.</p>
  </div>

  <div id="cartItems" style="padding:16px;"></div>

  <div class="summary">
    <label>Outlet</label>
    <select id="outletSelect"></select>

    <label style="margin-top:10px;display:block;">Catatan</label>
    <textarea id="cartNotes" rows="3" placeholder="Opsional..."></textarea>

    <h3>Total: <span id="totalPrice">Rp 0</span></h3>

    <button class="btn" onclick="openPopup()">Checkout</button>
    <button class="btn secondary" onclick="backProduct()">Tambah Menu</button>
  </div>
</section>

<div id="floatCart">
  <div class="float-inner">
    <div>
      <div style="font-size:13px;"><b id="floatCount">0</b> item</div>
      <div style="font-weight:800;" id="floatTotal">Rp 0</div>
    </div>
    <button class="float-btn" onclick="openCart()">Lihat Cart</button>
  </div>
</div>

<div id="optionPopup">
  <div class="inner-opt">
    <h3 id="optTitle">Pilih Opsi</h3>
    <label>Ice / Hot</label>
    <select id="optTemp"></select>

    <label>Gula</label>
    <select id="optSugar"></select>

    <label>Size</label>
    <select id="optSize"></select>

    <button class="btn" onclick="confirmOptions()">Tambah ke Keranjang</button>
    <button class="btn secondary" onclick="optionPopup.style.display='none'">Batal</button>
  </div>
</div>

<div id="popup">
  <div class="inner">
    <h3>Konfirmasi Pesanan</h3>
    <pre id="popupText" style="white-space:pre-wrap;font-size:14px;"></pre>
    <button class="btn" onclick="sendWA()">Benar</button>
    <button class="btn secondary" onclick="popup.style.display='none'" style="border-color:#ff6666;color:#ff6666;margin-top:8px;">Tidak</button>
  </div>
</div>

<script>
/* UTIL */
function rupiah(n){return "Rp "+n.toLocaleString("id-ID");}
function hashJSON(obj){
  return JSON.stringify(obj).split("").reduce((a,b)=>((a<<5)-a)+b.charCodeAt(0),0);
}
function save(k,v){localStorage.setItem(k,JSON.stringify(v));}
function load(k,d=null){let v=localStorage.getItem(k);return v?JSON.parse(v):d;}

let CURRENT_BRAND=null,CURRENT_PRODUCTS=[],CURRENT_OUTLETS=[],CART=load("cart",[]),USERNAME=load("username","");
let LIVE_VERSION=null,LIVE_HASH=null,OPT_PRODUCT=null;
let ACTIVE_CATEGORY="All",SEARCH_TEXT="",POLL=null;

/* PAGE NAV */
function goName(){splash.classList.add("hidden");namePage.classList.remove("hidden");}
function saveName(){
  const v=buyerName.value.trim();if(!v)return alert("Nama tidak boleh kosong.");
  USERNAME=v;save("username",v);
  namePage.classList.add("hidden");brandPage.classList.remove("hidden");
  helloUser.innerText=v;
}
function reloadBrand(){brandPage.classList.remove("hidden");productPage.classList.add("hidden");cartPage.classList.add("hidden");floatCart.style.display="none";}
function openBrand(k){
  CURRENT_BRAND=k;brandPage.classList.add("hidden");productPage.classList.remove("hidden");
  helloUser2.innerText=USERNAME;brandTitle.innerText=k.toUpperCase();
  loadBrand(k,true);
}
function backBrand(){productPage.classList.add("hidden");brandPage.classList.remove("hidden");floatCart.style.display="none";}
function openCart(){productPage.classList.add("hidden");cartPage.classList.remove("hidden");renderCart();}
function backProduct(){cartPage.classList.add("hidden");productPage.classList.remove("hidden");}

/* LOAD BRAND */
async function loadBrand(b,force=false){
  try{
    let res=await fetch(`data/${b}.json?x=`+Date.now());
    let data=await res.json();
    let norm=normalizeBrand(data);
    let v=norm.version||1,h=hashJSON(norm.products);

    if(force||v!==LIVE_VERSION||h!==LIVE_HASH){
      LIVE_VERSION=v;LIVE_HASH=h;
      CURRENT_PRODUCTS=norm.products;CURRENT_OUTLETS=norm.outlets||[];
      buildCategories(CURRENT_PRODUCTS);
      renderProducts(CURRENT_PRODUCTS);
    }

    startPolling(b);
  }catch(e){console.error(e);}
}
function normalizeBrand(d){
  return{
    version:d.version||1,
    brand:d.brand||"",
    outlets:d.outlets||[],
    products:(d.products||[]).map((p,i)=>({
      id:p.id||("prd-"+i),
      name:p.name||"Unnamed",
      price:p.price||0,
      image:p.image||"",
      category:p.category||guessCategory(p.name),
      variants:p.variants||{
        temperature:["Iced","Hot"],
        sugar:["Normal","Less Sugar"],
        size:["Small","Large"]
      }
    }))
  };
}
function startPolling(b){
  if(POLL)clearInterval(POLL);
  POLL=setInterval(()=>loadBrand(b,false),20000);
}
function guessCategory(n){
  n=n.toLowerCase();
  if(n.includes("latte")||n.includes("kopi")||n.includes("americano"))return"Coffee";
  if(n.includes("matcha")||n.includes("green"))return"Matcha";
  if(n.includes("tea"))return"Tea";
  if(n.includes("blend")||n.includes("frappe"))return"Frappe";
  if(n.includes("cake")||n.includes("croissant")||n.includes("sandwich"))return"Food";
  return"Other";
}

/* CATEGORY */
function buildCategories(list){
  const cats=["All",...new Set(list.map(p=>p.category))];
  categoryChips.innerHTML="";
  cats.forEach(cat=>{
    let el=document.createElement("div");
    el.className="chip";
    if(cat==="All")el.classList.add("active");
    el.innerText=cat;
    el.onclick=()=>setCategory(cat);
    categoryChips.appendChild(el);
  });
}
function setCategory(cat){
  ACTIVE_CATEGORY=cat;
  [...categoryChips.children].forEach(c=>c.classList.toggle("active",c.innerText===cat));
  filterAndRender();
}

/* SEARCH */
function onSearch(v){SEARCH_TEXT=v.toLowerCase();filterAndRender();}

/* FILTER PRODUK */
function filterAndRender(){
  let list=CURRENT_PRODUCTS;
  if(ACTIVE_CATEGORY!=="All")list=list.filter(p=>p.category===ACTIVE_CATEGORY);
  if(SEARCH_TEXT)list=list.filter(p=>p.name.toLowerCase().includes(SEARCH_TEXT));
  renderProducts(list);
}

/* RENDER PRODUK */
function renderProducts(list){
  productList.innerHTML="";
  if(list.length===0){
    productList.innerHTML=`<p style='color:var(--muted);padding:20px;'>Tidak ada produk.</p>`;
    return;
  }
  list.forEach(p=>{
    let card=document.createElement("div");card.className="product-card";

    let img=document.createElement("img");
    img.src=p.image;img.onerror=()=>img.src="img/error.png";

    let info=document.createElement("div");info.className="product-info";

    let h3=document.createElement("h3");h3.innerText=p.name;
    let cat=document.createElement("small");cat.innerText=p.category;

    let price=document.createElement("div");
    price.style.marginTop="4px";price.innerHTML=`<b>${rupiah(p.price)}</b>`;

    let btn=document.createElement("div");
    btn.className="add-btn";btn.innerText="+ Keranjang";
    btn.onclick=()=>openOptionPopup(p);

    info.append(h3,cat,price,btn);
    card.append(img,info);
    productList.appendChild(card);
  });
  updateFloatingCart();
}

/* VARIANT POPUP */
function openOptionPopup(p){
  OPT_PRODUCT=p;
  optTitle.innerText=p.name;
  optTemp.innerHTML=p.variants.temperature.map(v=>`<option>${v}</option>`).join("");
  optSugar.innerHTML=p.variants.sugar.map(v=>`<option>${v}</option>`).join("");
  optSize.innerHTML=p.variants.size.map(v=>`<option>${v}</option>`).join("");
  optionPopup.style.display="flex";
}
function confirmOptions(){
  if(!OPT_PRODUCT)return;
  let item={
    id:OPT_PRODUCT.id+"-"+Date.now(),
    name:OPT_PRODUCT.name,
    price:OPT_PRODUCT.price,
    base:OPT_PRODUCT.id,
    temp:optTemp.value,sugar:optSugar.value,size:optSize.value,
    image:OPT_PRODUCT.image,qty:1
  };
  CART.push(item);save("cart",CART);
  optionPopup.style.display="none";
  OPT_PRODUCT=null;
  updateBadge();updateFloatingCart();
}

/* CART */
function updateBadge(){
  let c=CART.length;
  if(c===0){
    badge.classList.add("hidden");badge2.classList.add("hidden");
  }else{
    badge.classList.remove("hidden");badge2.classList.remove("hidden");
    badge.innerText=c;badge2.innerText=c;
  }
}
function updateFloatingCart(){
  if(CART.length===0){floatCart.style.display="none";return;}
  floatCart.style.display="block";
  floatCount.innerText=CART.length;
  floatTotal.innerText=rupiah(CART.reduce((a,b)=>a+b.price*b.qty,0));
}

/* CART PAGE */
function renderCart(){
  cartItems.innerHTML="";
  if(CART.length===0){
    cartItems.innerHTML=`<p style='color:var(--muted);'>Keranjang masih kosong.</p>`;
    totalPrice.innerText="Rp 0";return;
  }
  CART.forEach(item=>{
    let row=document.createElement("div");
    row.className="cart-item";
    row.innerHTML=`
      <div style='flex:1;'>
        <b>${item.name}</b><br>
        <small>${item.temp} â€¢ ${item.sugar} â€¢ ${item.size}</small><br>
        <small>${rupiah(item.price)}</small>
      </div>

      <div style='display:flex;flex-direction:column;align-items:flex-end;'>
        <div>
          <button class='qty-btn' onclick="decQty('${item.id}')">-</button>
          <span style='padding:0 6px;font-weight:700;'>${item.qty}</span>
          <button class='qty-btn' onclick="incQty('${item.id}')">+</button>
        </div>
        <button class='remove-btn' onclick="removeItem('${item.id}')">Hapus</button>
      </div>
    `;
    cartItems.appendChild(row);
  });
  totalPrice.innerText=rupiah(CART.reduce((a,b)=>a+b.price*b.qty,0));
  outletSelect.innerHTML=CURRENT_OUTLETS.map(o=>`<option>${o}</option>`).join("");
}
function incQty(id){CART=CART.map(x=>{if(x.id===id)x.qty++;return x});save("cart",CART);renderCart();updateBadge();updateFloatingCart();}
function decQty(id){CART=CART.map(x=>{if(x.id===id&&x.qty>1)x.qty--;return x});save("cart",CART);renderCart();updateBadge();updateFloatingCart();}
function removeItem(id){CART=CART.filter(x=>x.id!==id);save("cart",CART);renderCart();updateBadge();updateFloatingCart();}

/* CHECKOUT POPUP */
function openPopup(){
  if(CART.length===0)return alert("Keranjang kosong!");
  let txt=`Pesanan untuk: ${USERNAME}
Brand: ${CURRENT_BRAND.toUpperCase()}
Outlet: ${outletSelect.value}

`;
  CART.forEach((it,i)=>{
    txt+=`${i+1}. ${it.name}
   ${it.temp} â€¢ ${it.sugar} â€¢ ${it.size}
   Qty: ${it.qty} x ${rupiah(it.price)}
   Total: ${rupiah(it.qty*it.price)}

`;
  });
  let grand=CART.reduce((a,b)=>a+b.price*b.qty,0);
  txt+=`Total: ${rupiah(grand)}

`;
  let notes=cartNotes.value.trim();
  if(notes)txt+=`Catatan:
${notes}
`;
  popupText.innerText=txt;popup.style.display="flex";
}
function sendWA(){
  let txt=popupText.innerText;
  let url="https://wa.me/6281294944774?text="+encodeURIComponent(txt);
  window.open(url,"_blank");
  CART=[];save("cart",CART);
  popup.style.display="none";renderCart();updateBadge();updateFloatingCart();
}

/* INIT */
window.onload=()=>{
  if(USERNAME){
    splash.classList.add("hidden");namePage.classList.add("hidden");
    brandPage.classList.remove("hidden");helloUser.innerText=USERNAME;
  }
  updateBadge();updateFloatingCart();
};
</script>

</body>
</html>
