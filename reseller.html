<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>LIXY Store â€“ Reseller</title>

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700;800&display=swap" rel="stylesheet">

<style>
  :root{
    --bg:#0b0c10;
    --bg2:#0f1117;
    --card:#141722;
    --card2:#171a26;
    --line:#252a3b;
    --text:#ffffff;
    --muted:#a7adc0;
    --muted2:#8c93aa;
    --accent:#39ffb4;
    --accent2:#00d38f;
    --danger:#ff5b5b;
    --warning:#ffc14a;

    --r12:12px;
    --r16:16px;
    --r20:20px;

    --shadow: 0 10px 28px rgba(0,0,0,.45);
    --shadow2: 0 14px 40px rgba(0,0,0,.55);
  }

  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0;
    font-family:Poppins,sans-serif;
    background:
      radial-gradient(900px 600px at 20% -10%, rgba(57,255,180,.12), transparent 60%),
      radial-gradient(900px 600px at 100% 0%, rgba(0,211,143,.10), transparent 55%),
      linear-gradient(180deg, var(--bg) 0%, #07080b 100%);
    color:var(--text);
    -webkit-tap-highlight-color:transparent;
  }
  button, input, select, textarea{font-family:inherit}
  .hidden{display:none!important}

  /* ===== App Container ===== */
  .app{
    min-height:100vh;
    padding-bottom:88px; /* space for float cart */
  }

  /* ===== Top Bar ===== */
  header{
    position:sticky; top:0; z-index:60;
    background:rgba(11,12,16,.78);
    backdrop-filter: blur(14px);
    border-bottom:1px solid rgba(255,255,255,.06);
    padding:12px 14px;
    display:flex; align-items:center; justify-content:space-between;
  }
  .brand-left{display:flex; align-items:center; gap:10px}
  header img{
    width:40px;height:40px;border-radius:50%;
    object-fit:cover; cursor:pointer;
    border:1px solid rgba(255,255,255,.10);
    box-shadow:0 10px 20px rgba(0,0,0,.35);
  }
  .head-title{
    font-weight:800; font-size:16px; line-height:1.1;
  }
  .head-sub{
    font-size:12px; color:var(--muted);
    margin-top:2px;
  }
  .cart-mini{
    position:relative;
    background:rgba(255,255,255,.06);
    border:1px solid rgba(255,255,255,.08);
    padding:8px 10px;
    border-radius:999px;
    display:flex; align-items:center; gap:8px;
    cursor:pointer;
    font-weight:700;
  }
  .badge{
    width:18px;height:18px;border-radius:50%;
    background:var(--danger);
    display:flex; align-items:center; justify-content:center;
    font-size:11px; font-weight:800;
    border:2px solid rgba(11,12,16,.9);
  }

  /* ===== Buttons ===== */
  .btn{
    width:100%;
    padding:12px 14px;
    border:none;
    border-radius:14px;
    font-weight:800;
    font-size:15px;
    cursor:pointer;
  }
  .btn.primary{
    color:#05110c;
    background:linear-gradient(135deg, var(--accent), var(--accent2));
    box-shadow:0 12px 30px rgba(57,255,180,.16);
  }
  .btn.secondary{
    background:rgba(255,255,255,.06);
    border:1px solid rgba(255,255,255,.10);
    color:#fff;
  }
  .btn.danger{
    background:transparent;
    border:1px solid rgba(255,91,91,.35);
    color:var(--danger);
  }

  /* ===== Inputs ===== */
  .input{
    width:100%;
    padding:12px 14px;
    border-radius:14px;
    border:1px solid rgba(255,255,255,.10);
    background:rgba(255,255,255,.05);
    color:#fff;
    outline:none;
  }
  .input:focus{
    border-color: rgba(57,255,180,.55);
    box-shadow: 0 0 0 3px rgba(57,255,180,.10);
  }

  /* ===== Splash ===== */
  #splash{
    height:100vh;
    display:flex;
    align-items:center;
    justify-content:center;
    padding:20px;
  }
  .splash-card{
    width:min(520px, 100%);
    background:linear-gradient(180deg, rgba(20,23,34,.92), rgba(17,19,27,.92));
    border:1px solid rgba(255,255,255,.08);
    border-radius:22px;
    padding:28px 22px;
    box-shadow: var(--shadow2);
    text-align:center;
  }
  .logo{
    width:128px;height:128px;
    border-radius:28px;
    overflow:hidden;
    margin:0 auto 14px;
    border:1px solid rgba(255,255,255,.10);
    box-shadow:0 18px 40px rgba(0,0,0,.45);
  }
  .logo img{width:100%;height:100%;object-fit:cover}
  .splash-title{font-size:26px;font-weight:900;margin:0}
  .splash-sub{color:var(--muted);margin:8px 0 0;font-size:14px}
  .progress-wrap{
    width:100%;
    height:10px;
    background:rgba(255,255,255,.06);
    border:1px solid rgba(255,255,255,.10);
    border-radius:999px;
    overflow:hidden;
    margin-top:18px;
  }
  .progress-bar{
    height:100%;
    width:0%;
    background:linear-gradient(90deg, var(--accent), var(--accent2));
    animation:loadbar 1.85s ease forwards;
  }
  @keyframes loadbar{to{width:100%;}}

  /* ===== Pages (common) ===== */
  .page{
    width:min(1080px, 100%);
    margin:0 auto;
  }
  .pad{padding:14px}
  .section-title{
    font-weight:900;
    font-size:18px;
    margin:0;
    letter-spacing:.2px;
  }
  .section-sub{
    color:var(--muted);
    margin:6px 0 0;
    font-size:13px;
  }

  /* ===== Name Page ===== */
  #namePage{
    min-height:100vh;
    display:flex;
    align-items:center;
    justify-content:center;
    padding:18px;
  }
  .card{
    width:min(520px, 100%);
    background:linear-gradient(180deg, rgba(20,23,34,.92), rgba(17,19,27,.92));
    border:1px solid rgba(255,255,255,.08);
    border-radius:22px;
    padding:18px;
    box-shadow:var(--shadow2);
  }
  .row{display:flex;gap:10px;align-items:center}
  .row > *{flex:1}

  /* ===== Brand Grid ===== */
  .brand-grid{
    padding:14px;
    display:grid;
    grid-template-columns:repeat(2, 1fr);
    gap:12px;
  }
  @media(min-width:700px){
    .brand-grid{grid-template-columns:repeat(5, 1fr)}
  }
  .brand-item{
    background:linear-gradient(180deg, rgba(20,23,34,.90), rgba(16,18,26,.90));
    border:1px solid rgba(255,255,255,.08);
    border-radius:18px;
    padding:16px 14px;
    cursor:pointer;
    transition:.18s ease;
    position:relative;
    overflow:hidden;
    box-shadow:0 10px 24px rgba(0,0,0,.35);
    min-height:86px;
    display:flex;
    flex-direction:column;
    justify-content:space-between;
  }
  .brand-item:hover{transform:translateY(-2px);border-color:rgba(57,255,180,.35)}
  .brand-name{font-weight:900;font-size:15px;margin:0}
  .brand-meta{color:var(--muted);font-size:12px;margin-top:2px}
  .pill{
    display:inline-flex;
    align-items:center;
    gap:6px;
    width:max-content;
    padding:6px 10px;
    border-radius:999px;
    font-size:11px;
    font-weight:800;
    border:1px solid rgba(255,255,255,.10);
    background:rgba(255,255,255,.06);
    color:#fff;
    margin-top:10px;
  }
  .pill.green{
    background:rgba(57,255,180,.12);
    border-color:rgba(57,255,180,.25);
    color:var(--accent);
  }
  .pill.yellow{
    background:rgba(255,193,74,.10);
    border-color:rgba(255,193,74,.22);
    color:var(--warning);
  }

  /* ===== Search + Chips ===== */
  .search-wrap{
    position:sticky;
    top:68px;
    z-index:55;
    background:rgba(11,12,16,.78);
    backdrop-filter: blur(14px);
    border-bottom:1px solid rgba(255,255,255,.06);
    padding:12px 14px;
  }
  .search-input{
    display:flex; gap:10px; align-items:center;
    background:rgba(255,255,255,.05);
    border:1px solid rgba(255,255,255,.10);
    border-radius:16px;
    padding:10px 12px;
  }
  .search-input input{
    border:none; outline:none; background:transparent; color:#fff;
    width:100%; font-size:14px;
  }
  .chips{
    display:flex; gap:10px;
    overflow-x:auto;
    padding:10px 14px 12px;
    border-bottom:1px solid rgba(255,255,255,.06);
    background:rgba(11,12,16,.55);
    backdrop-filter: blur(10px);
  }
  .chips::-webkit-scrollbar{height:0}
  .chip{
    white-space:nowrap;
    padding:9px 12px;
    border-radius:999px;
    background:rgba(255,255,255,.06);
    border:1px solid rgba(255,255,255,.10);
    color:#fff;
    font-size:12px;
    font-weight:800;
    cursor:pointer;
    transition:.15s ease;
  }
  .chip.active{
    background:rgba(57,255,180,.14);
    border-color:rgba(57,255,180,.30);
    color:var(--accent);
  }

  /* ===== Product List ===== */
  #productList{
    padding:14px;
    display:grid;
    grid-template-columns:1fr;
    gap:12px;
  }
  @media(min-width:900px){
    #productList{grid-template-columns:repeat(2, 1fr)}
  }
  .product-card{
    display:flex;
    gap:12px;
    padding:12px;
    border-radius:18px;
    background:linear-gradient(180deg, rgba(20,23,34,.90), rgba(16,18,26,.90));
    border:1px solid rgba(255,255,255,.08);
    box-shadow:0 10px 26px rgba(0,0,0,.35);
    transition:.18s ease;
  }
  .product-card:hover{transform:translateY(-2px);border-color:rgba(57,255,180,.28)}
  .product-card img{
    width:108px;height:108px;
    border-radius:16px;
    object-fit:cover;
    background:#000;
    flex-shrink:0;
    border:1px solid rgba(255,255,255,.08);
  }
  .product-info{flex:1;min-width:0}
  .product-info h3{
    margin:0;
    font-size:15px;
    font-weight:900;
    white-space:nowrap;
    overflow:hidden;
    text-overflow:ellipsis;
    letter-spacing:.1px;
  }
  .meta-row{
    display:flex;
    gap:8px;
    align-items:center;
    margin-top:6px;
    flex-wrap:wrap;
  }
  .meta{
    font-size:11px;
    color:var(--muted);
    padding:5px 8px;
    border-radius:999px;
    background:rgba(255,255,255,.05);
    border:1px solid rgba(255,255,255,.08);
  }
  .price{
    margin-top:8px;
    font-weight:900;
    font-size:15px;
  }
  .add-btn{
    margin-top:10px;
    display:inline-flex;
    align-items:center;
    justify-content:center;
    gap:8px;
    padding:9px 12px;
    border-radius:14px;
    font-weight:900;
    font-size:13px;
    cursor:pointer;
    user-select:none;
    color:#05110c;
    background:linear-gradient(135deg, var(--accent), var(--accent2));
    box-shadow:0 12px 26px rgba(57,255,180,.14);
  }

  /* ===== Cart List ===== */
  .cart-item{
    background:linear-gradient(180deg, rgba(20,23,34,.90), rgba(16,18,26,.90));
    border:1px solid rgba(255,255,255,.08);
    border-radius:18px;
    padding:12px;
    margin-bottom:12px;
    display:flex;
    justify-content:space-between;
    gap:12px;
    box-shadow:0 10px 26px rgba(0,0,0,.33);
  }
  .cart-title{font-weight:900}
  .cart-sub{color:var(--muted);font-size:12px;margin-top:3px}
  .cart-price{margin-top:6px;font-weight:900}
  .qty{
    display:flex; align-items:center; gap:8px;
    background:rgba(255,255,255,.05);
    border:1px solid rgba(255,255,255,.08);
    border-radius:999px;
    padding:6px 8px;
  }
  .qty-btn{
    width:34px;height:34px;border-radius:10px;
    border:none; cursor:pointer;
    background:rgba(57,255,180,.14);
    color:var(--accent);
    font-weight:900;
  }
  .qty span{min-width:18px; text-align:center; font-weight:900}
  .remove-btn{
    margin-top:8px;
    width:100%;
    border:none;
    background:transparent;
    color:var(--danger);
    font-weight:900;
    cursor:pointer;
  }

  .summary{
    padding:14px;
    position:sticky;
    bottom:0;
    background:rgba(11,12,16,.88);
    backdrop-filter: blur(14px);
    border-top:1px solid rgba(255,255,255,.06);
  }
  .summary-card{
    width:min(1080px, 100%);
    margin:0 auto;
    background:rgba(255,255,255,.04);
    border:1px solid rgba(255,255,255,.08);
    border-radius:20px;
    padding:14px;
    box-shadow:0 10px 26px rgba(0,0,0,.35);
  }
  .summary-row{
    display:flex;
    justify-content:space-between;
    align-items:center;
    gap:10px;
    margin-top:10px;
  }
  .total-label{color:var(--muted);font-size:12px;font-weight:800}
  .total-value{font-size:18px;font-weight:1000; letter-spacing:.2px}

  /* ===== Float Cart (sticky bottom bar) ===== */
  #floatCart{
    display:none;
    position:fixed;
    left:0; right:0; bottom:0;
    z-index:90;
    padding:10px 14px;
    background:rgba(11,12,16,.90);
    backdrop-filter: blur(14px);
    border-top:1px solid rgba(255,255,255,.06);
  }
  .float-inner{
    width:min(1080px, 100%);
    margin:0 auto;
    display:flex;
    justify-content:space-between;
    align-items:center;
    gap:12px;
  }
  .float-left{
    display:flex;
    flex-direction:column;
    gap:2px;
  }
  .float-count{font-size:12px;color:var(--muted);font-weight:800}
  .float-total{font-size:16px;font-weight:1000}
  .float-btn{
    border:none;
    border-radius:14px;
    padding:10px 14px;
    font-weight:1000;
    cursor:pointer;
    background:linear-gradient(135deg, var(--accent), var(--accent2));
    color:#05110c;
    box-shadow:0 14px 30px rgba(57,255,180,.14);
  }

  /* ===== Option Popup ===== */
  #optionPopup{
    display:none;
    position:fixed; inset:0;
    background:rgba(0,0,0,.62);
    justify-content:center;
    align-items:flex-end;
    padding:14px;
    z-index:120;
  }
  .inner-opt{
    width:min(520px, 100%);
    background:linear-gradient(180deg, rgba(20,23,34,.98), rgba(16,18,26,.98));
    border:1px solid rgba(255,255,255,.10);
    border-radius:24px;
    padding:16px;
    box-shadow: var(--shadow2);
  }
  .inner-opt h3{margin:0 0 10px;font-weight:1000}
  .price-badge{
    display:inline-flex;
    align-items:center;
    gap:8px;
    padding:8px 12px;
    border-radius:999px;
    background:rgba(57,255,180,.12);
    border:1px solid rgba(57,255,180,.22);
    color:var(--accent);
    font-weight:1000;
    margin-bottom:10px;
  }
  .inner-opt label{display:block;margin-top:10px;font-size:12px;color:var(--muted);font-weight:800}
  .inner-opt select{
    width:100%;
    padding:12px 12px;
    margin-top:6px;
    border-radius:14px;
    border:1px solid rgba(255,255,255,.10);
    background:rgba(255,255,255,.05);
    color:#fff;
    outline:none;
  }
  .inner-opt select:focus{
    border-color: rgba(57,255,180,.55);
    box-shadow: 0 0 0 3px rgba(57,255,180,.10);
  }
  .opt-actions{
    display:flex;
    gap:10px;
    margin-top:12px;
  }
  .opt-actions .btn{margin-top:0}

  /* ===== Checkout Popup ===== */
  #popup{
    display:none;
    position:fixed; inset:0;
    background:rgba(0,0,0,.68);
    justify-content:center;
    align-items:center;
    padding:14px;
    z-index:130;
    touch-action: pan-y;
  }
  #popup .inner{
    width:min(560px, 100%);
    background:linear-gradient(180deg, rgba(20,23,34,.98), rgba(16,18,26,.98));
    border:1px solid rgba(255,255,255,.10);
    border-radius:24px;
    padding:16px;
    box-shadow: var(--shadow2);
    max-height:85vh;
    overflow:auto;
    -webkit-overflow-scrolling: touch;
  }
  #popupText{
    max-height:60vh;
    overflow:auto;
    -webkit-overflow-scrolling: touch;
    white-space:pre-wrap;
    background:rgba(255,255,255,.04);
    border:1px solid rgba(255,255,255,.08);
    border-radius:18px;
    padding:12px;
    margin:12px 0;
    color:#e9ecf7;
    font-size:13px;
    line-height:1.5;
  }

  /* ===== Custom Outlet Dropdown ===== */
  .outlet-box{
    background:rgba(255,255,255,.04);
    border:1px solid rgba(255,255,255,.08);
    border-radius:18px;
    overflow:hidden;
  }
  .outlet-selected{
    padding:12px 12px;
    font-weight:1000;
    display:flex;
    align-items:center;
    justify-content:space-between;
    gap:10px;
  }
  .outlet-selected .chev{color:var(--muted);font-weight:900}
  .outlet-panel{
    border-top:1px solid rgba(255,255,255,.08);
    max-height:260px;
    overflow:auto;
    display:block; /* search & list selalu terlihat */
  }
  .outlet-search{
    width:100%;
    padding:12px 12px;
    border:none;
    border-bottom:1px solid rgba(255,255,255,.08);
    outline:none;
    background:rgba(255,255,255,.03);
    color:#fff;
    font-weight:700;
  }
  .outlet-item{
    padding:11px 12px;
    cursor:pointer;
    font-weight:800;
    color:#f4f6ff;
  }
  .outlet-item:hover{background:rgba(255,255,255,.05)}
  .outlet-item.active{
    font-weight:1000;
    background:rgba(57,255,180,.12);
    color:var(--accent);
  }

  /* ===== Loading Overlay ===== */
  #loadingOverlay{
    display:none;
    position:fixed; inset:0;
    z-index:300;
    background:rgba(11,12,16,.78);
    backdrop-filter: blur(12px);
    align-items:center;
    justify-content:center;
    flex-direction:column;
    gap:10px;
  }
  #loadingOverlay .spinner{
    width:58px;height:58px;border-radius:50%;
    border:4px solid rgba(255,255,255,.10);
    border-top-color: var(--accent);
    animation:spin 1s linear infinite;
    box-shadow:0 0 22px rgba(57,255,180,.18);
  }
  #loadingOverlay .loading-text{
    color:var(--muted);
    font-weight:800;
    font-size:13px;
    letter-spacing:.2px;
  }
  @keyframes spin{to{transform:rotate(360deg)}}
</style>
</head>

<body>
<div class="app">

  <!-- Splash -->
  <section id="splash">
    <div class="splash-card">
      <div class="logo"><img src="img/lglixystore.png" alt="LIXY"></div>
      <h2 class="splash-title">LIXY STORE</h2>
      <p class="splash-sub">reseller marketplace â€¢ coffee & tea</p>
      <div class="progress-wrap"><div class="progress-bar" id="splashBar"></div></div>
    </div>
  </section>

  <!-- Name page -->
  <section id="namePage" class="hidden">
    <div class="card">
      <h2 class="section-title">Masukkan Nama Kamu</h2>
      <p class="section-sub">Nama akan dipakai di pesan WhatsApp.</p>
      <div style="height:10px"></div>
      <input id="buyerName" class="input" placeholder="Nama lengkap..." maxlength="24" />
      <button class="btn primary" style="margin-top:12px" onclick="saveName()">Lanjut</button>
      <div class="pill yellow" style="margin-top:12px">Mode Reseller aktif (+4000)</div>
    </div>
  </section>

  <!-- Brand page -->
  <section id="brandPage" class="hidden">
    <header>
      <div class="brand-left">
        <img src="img/lglixystore.png" alt="logo" onclick="reloadBrand()">
        <div>
          <div class="head-title" id="helloUser">LIXY Store</div>
          <div class="head-sub">Pilih brand untuk mulai belanja</div>
        </div>
      </div>
      <div class="cart-mini" onclick="openCart()">
        ðŸ›’ <span>Cart</span>
        <span id="badge" class="badge hidden">0</span>
      </div>
    </header>

    <div class="page pad">
      <div style="display:flex;justify-content:space-between;align-items:flex-end;gap:10px;flex-wrap:wrap;">
        <div>
          <h2 class="section-title">Pilih Brand</h2>
          <p class="section-sub">Marketplace feel: cepat, rapi, mobile-friendly.</p>
        </div>
        <button class="btn secondary" style="width:auto;padding:10px 12px" onclick="goChangeName()">Ganti Nama</button>
      </div>
    </div>

    <div class="brand-grid page">
      <div class="brand-item" onclick="openBrand('fore')">
        <div>
          <p class="brand-name">Fore</p>
          <p class="brand-meta">Coffee â€¢ Best Seller</p>
        </div>
        <span class="pill green">Ready</span>
      </div>
      <div class="brand-item" onclick="openBrand('kenangan')">
        <div>
          <p class="brand-name">Kopi Kenangan</p>
          <p class="brand-meta">Coffee â€¢ Popular</p>
        </div>
        <span class="pill green">Ready</span>
      </div>
      <div class="brand-item" onclick="openBrand('janjijiwa')">
        <div>
          <p class="brand-name">Janji Jiwa</p>
          <p class="brand-meta">Coffee â€¢ Fresh</p>
        </div>
        <span class="pill green">Ready</span>
      </div>
      <div class="brand-item" onclick="openBrand('tomoro')">
        <div>
          <p class="brand-name">Tomoro</p>
          <p class="brand-meta">Coffee â€¢ New</p>
        </div>
        <span class="pill green">Ready</span>
      </div>
      <div class="brand-item" onclick="openBrand('chagee')">
        <div>
          <p class="brand-name">Chagee</p>
          <p class="brand-meta">Tea â€¢ Variant price</p>
        </div>
        <span class="pill green">Ready</span>
      </div>
    </div>
  </section>

  <!-- Product page -->
  <section id="productPage" class="hidden">
    <header>
      <div class="brand-left">
        <img src="img/lglixystore.png" alt="logo" onclick="backBrand()">
        <div>
          <div class="head-title" id="brandTitle">Produk</div>
          <div class="head-sub">Hi, <span id="helloUser2"></span> ðŸ‘‹</div>
        </div>
      </div>
      <div class="cart-mini" onclick="openCart()">
        ðŸ›’ <span>Cart</span>
        <span id="badge2" class="badge hidden">0</span>
      </div>
    </header>

    <div class="search-wrap">
      <div class="search-input">
        <span style="color:var(--muted);font-weight:900;">ðŸ”Ž</span>
        <input id="searchInput" placeholder="Cari menu, latte, matcha..." oninput="onSearch(this.value)">
      </div>
    </div>

    <div id="categoryChips" class="chips"></div>
    <div id="productList" class="page"></div>
  </section>

  <!-- Cart page -->
  <section id="cartPage" class="hidden">
    <header>
      <div class="brand-left">
        <img src="img/lglixystore.png" alt="logo" onclick="backProduct()">
        <div>
          <div class="head-title">Keranjang</div>
          <div class="head-sub">Cek sebelum checkout ya</div>
        </div>
      </div>
      <div style="width:44px"></div>
    </header>

    <div class="page pad">
      <h2 class="section-title">Pesanan Kamu</h2>
      <p class="section-sub">Mode reseller aktif: semua harga sudah ditambah +4000.</p>
    </div>

    <div id="cartItems" class="page" style="padding:0 14px 14px;"></div>

    <!-- Summary sticky bottom -->
    <div class="summary">
      <div class="summary-card">
        <div style="display:flex;justify-content:space-between;align-items:center;gap:10px;">
          <div>
            <div class="total-label">Total pembayaran</div>
            <div class="total-value" id="totalPrice">Rp 0</div>
          </div>
          <div class="pill yellow">Reseller +4000</div>
        </div>

        <div style="margin-top:12px;">
          <div style="font-size:12px;color:var(--muted);font-weight:900;margin-bottom:8px;">Outlet</div>
          <div id="outletWrapper"></div>
        </div>

        <div style="margin-top:12px;">
          <div style="font-size:12px;color:var(--muted);font-weight:900;margin-bottom:8px;">Catatan</div>
          <textarea id="cartNotes" class="input" rows="3" placeholder="Opsional..."></textarea>
        </div>

        <div class="summary-row">
          <button class="btn primary" onclick="openPopup()">Checkout</button>
        </div>
        <div style="margin-top:10px;">
          <button class="btn secondary" onclick="backProduct()">Tambah Menu</button>
        </div>
      </div>
    </div>
  </section>

  <!-- Float cart -->
  <div id="floatCart">
    <div class="float-inner">
      <div class="float-left">
        <div class="float-count"><b id="floatCount">0</b> item di keranjang</div>
        <div class="float-total" id="floatTotal">Rp 0</div>
      </div>
      <button class="float-btn" onclick="openCart()">Checkout</button>
    </div>
  </div>

  <!-- Variant popup -->
  <div id="optionPopup">
    <div class="inner-opt">
      <h3 id="optTitle">Pilih Opsi</h3>
      <div class="price-badge">ðŸ’³ <span id="popupPrice">Rp 0</span></div>

      <label>Ice / Hot</label>
      <select id="optTemp"></select>

      <label>Gula</label>
      <select id="optSugar"></select>

      <label>Size</label>
      <select id="optSize"></select>

      <div class="opt-actions">
        <button class="btn primary" onclick="confirmOptions()">Tambah</button>
        <button class="btn secondary" onclick="closeOptionPopup()">Batal</button>
      </div>
    </div>
  </div>

  <!-- Checkout popup -->
  <div id="popup">
    <div class="inner">
      <h3 style="margin:0;font-weight:1000;">Konfirmasi Pesanan</h3>
      <div class="section-sub" style="margin-top:6px">Scroll di HP aman âœ…</div>

      <div style="margin-top:12px;">
        <div style="font-size:12px;color:var(--muted);font-weight:900;margin-bottom:8px;">Outlet</div>
        <!-- outlet tetap dibaca dari localStorage oleh fungsi openPopup() -->
        <div id="popupOutletHint" class="pill" style="margin-bottom:10px;">Pastikan outlet sudah dipilih di halaman keranjang</div>
      </div>

      <pre id="popupText"></pre>

      <button class="btn primary" onclick="sendWA()">Benar, Kirim WhatsApp</button>
      <button class="btn danger" onclick="closePopup()" style="margin-top:10px;">Tidak</button>
    </div>
  </div>

  <!-- Loading overlay -->
  <div id="loadingOverlay">
    <div class="spinner"></div>
    <div class="loading-text">Loading menu...</div>
  </div>

</div>

<script>
// === KONFIG RESELLER (tetap sama) ===
const IS_RESELLER = true;      // ubah ke false jika tidak ingin mode reseller
const RESELLER_PLUS = 4000;    // semua harga +4000 di mode reseller

/* =========================
   Utils (tetap sama)
========================= */
function rupiah(n){ return "Rp " + Number(n||0).toLocaleString("id-ID"); }
function applyReseller(price){
  return IS_RESELLER ? (Number(price||0) + RESELLER_PLUS) : Number(price||0);
}
function hashJSON(obj){
  try{
    return JSON.stringify(obj).split("").reduce((a,b)=>((a<<5)-a)+b.charCodeAt(0),0);
  }catch(e){ return Math.random(); }
}
function save(k,v){ localStorage.setItem(k, JSON.stringify(v)); }
function load(k,d=null){ const v=localStorage.getItem(k); return v ? JSON.parse(v) : d; }
function showLoading(on){
  const ol=document.getElementById("loadingOverlay");
  if(!ol) return;
  ol.style.display = on ? "flex" : "none";
}

/* =========================
   State (tetap sama)
========================= */
let CURRENT_BRAND=null;
let CURRENT_BRAND_DATA=null;
let CURRENT_PRODUCTS=[];
let CURRENT_OUTLETS=[];
let CART=load("cart",[]);
let USERNAME=load("username","");
let LIVE_VERSION=null, LIVE_HASH=null, POLL=null;
let ACTIVE_CATEGORY="All", SEARCH_TEXT="";
let OPT_PRODUCT=null;

/* =========================
   Navigation (tetap sama)
========================= */
function saveName(){
  const v=buyerName.value.trim();
  if(!v) return alert("Nama tidak boleh kosong.");
  USERNAME=v; save("username", v);

  namePage.classList.add("hidden");
  brandPage.classList.remove("hidden");
  helloUser.innerText=v;
  helloUser2.innerText=v;
}

function goChangeName(){
  if(POLL) clearInterval(POLL);

  brandPage.classList.add("hidden");
  productPage.classList.add("hidden");
  cartPage.classList.add("hidden");

  namePage.classList.remove("hidden");
  buyerName.value=USERNAME||"";
  buyerName.focus();
}

function reloadBrand(){
  brandPage.classList.remove("hidden");
  productPage.classList.add("hidden");
  cartPage.classList.add("hidden");
  floatCart.style.display="none";
}

function openBrand(key){
  CURRENT_BRAND=key;
  brandPage.classList.add("hidden");
  productPage.classList.remove("hidden");

  helloUser2.innerText=USERNAME;
  brandTitle.innerText=key.toUpperCase();

  loadBrand(key,true);
}

function backBrand(){
  productPage.classList.add("hidden");
  brandPage.classList.remove("hidden");
  floatCart.style.display="none";
}

function openCart(){
  productPage.classList.add("hidden");
  cartPage.classList.remove("hidden");
  renderCart();
}

function backProduct(){
  cartPage.classList.add("hidden");
  productPage.classList.remove("hidden");
}

/* =========================
   Brand JSON (tetap sama)
========================= */
async function loadBrand(brand, force=false){
  showLoading(true);
  try{
    // pakai path relatif agar aman di subfolder hosting
    const res = await fetch(`./data/${brand}.json?ts=`+Date.now(), { cache:"no-store" });
    if(!res.ok) throw new Error("HTTP "+res.status);

    const data = await res.json();
    const norm = normalizeBrand(data);
    const v = norm.version || 1;
    const h = hashJSON(norm.products);

    if(force || v!==LIVE_VERSION || h!==LIVE_HASH){
      LIVE_VERSION=v; LIVE_HASH=h;
      CURRENT_BRAND_DATA=norm;
      CURRENT_PRODUCTS=norm.products;
      CURRENT_OUTLETS=norm.outlets || [];

      buildCategories(CURRENT_PRODUCTS);
      renderProducts(CURRENT_PRODUCTS);
    }

    startPolling(brand);
  }catch(e){
    console.error(e);
    productList.innerHTML = `<p style="color:var(--muted);padding:20px;">Gagal memuat menu brand ini.</p>`;
  }finally{
    showLoading(false);
  }
}

function normalizeBrand(d){
  const arr = Array.isArray(d.products) ? d.products : (d.items || []);
  return{
    version:d.version||1,
    brand:d.brand||"",
    outlets: Array.isArray(d.outlets) ? d.outlets : (d.outlets === "manual" ? "manual" : []),
    products: arr.map((p,i)=>({
      id:p.id||("prd-"+i),
      name:p.name||"Unnamed",
      price:Number(p.price)||0,
      image:p.image||"",
      category:p.category||guessCategory(p.name||""),
      variants:p.variants||{
        temperature:["Iced","Hot"],
        sugar:["Normal","Less Sugar"],
        size:["Small","Large"]
      },
      // penting: agar calculateFinalPrice chagee bisa jalan
      variantPricing: p.variantPricing || null
    }))
  };
}

function startPolling(brand){
  if(POLL) clearInterval(POLL);
  POLL = setInterval(()=>loadBrand(brand,false), 20000);
}

function guessCategory(n){
  n=n.toLowerCase();
  if(n.includes("latte")||n.includes("kopi")||n.includes("americano")) return "Coffee";
  if(n.includes("matcha")||n.includes("green")) return "Matcha";
  if(n.includes("tea")) return "Tea";
  if(n.includes("blend")||n.includes("frappe")) return "Frappe";
  if(n.includes("cake")||n.includes("croissant")||n.includes("sandwich")) return "Food";
  return "Other";
}

/* =========================
   Category & search (tetap sama)
========================= */
function buildCategories(list){
  const cats=["All", ...new Set(list.map(p=>p.category))];
  categoryChips.innerHTML="";
  cats.forEach(cat=>{
    const el=document.createElement("div");
    el.className="chip";
    if(cat==="All") el.classList.add("active");
    el.textContent=cat;
    el.onclick=()=>setCategory(cat);
    categoryChips.appendChild(el);
  });
  ACTIVE_CATEGORY="All";
}
function setCategory(cat){
  ACTIVE_CATEGORY=cat;
  [...categoryChips.children].forEach(c=>c.classList.toggle("active",c.textContent===cat));
  filterAndRender();
}
function onSearch(v){
  SEARCH_TEXT=(v||"").toLowerCase();
  filterAndRender();
}
function filterAndRender(){
  let list=[...CURRENT_PRODUCTS];
  if(ACTIVE_CATEGORY!=="All") list=list.filter(p=>p.category===ACTIVE_CATEGORY);
  if(SEARCH_TEXT) list=list.filter(p=>p.name.toLowerCase().includes(SEARCH_TEXT));
  renderProducts(list);
}

/* =========================
   Render products (fungsi sama, UI card ikut class yang sama)
========================= */
function renderProducts(list){
  productList.innerHTML="";
  if(list.length===0){
    productList.innerHTML=`<p style="color:var(--muted);padding:20px;">Tidak ada produk.</p>`;
    return;
  }

  list.forEach(p=>{
    const card=document.createElement("div");
    card.className="product-card";

    const img=document.createElement("img");
    img.src=p.image;
    img.onerror=()=>img.src="img/error.png";

    const info=document.createElement("div");
    info.className="product-info";

    const h3=document.createElement("h3");
    h3.textContent=p.name;

    const metaRow=document.createElement("div");
    metaRow.className="meta-row";

    const cat=document.createElement("div");
    cat.className="meta";
    cat.textContent=p.category || "Menu";

    // â€œmarketplace feelâ€ dummy badge (tidak mengubah fungsi)
    const badge2=document.createElement("div");
    badge2.className="meta";
    badge2.textContent="â­ 4.8 â€¢ Terlaris";

    metaRow.append(cat,badge2);

    const price=document.createElement("div");
    price.className="price";
    const displayPrice = applyReseller(p.price);
    price.innerHTML=`${rupiah(displayPrice)}`;

    const btn=document.createElement("div");
    btn.className="add-btn";
    btn.innerHTML="âž• Tambah";
    btn.onclick=()=>openOptionPopup(p);

    info.append(h3,metaRow,price,btn);
    card.append(img,info);
    productList.appendChild(card);
  });

  updateFloatingCart();
}

/* =========================
   Variant popup + pricing (tetap sama)
========================= */
function openOptionPopup(p){
  OPT_PRODUCT=p;

  optTitle.textContent=p.name;
  optTemp.innerHTML=p.variants.temperature.map(v=>`<option>${v}</option>`).join("");
  optSugar.innerHTML=p.variants.sugar.map(v=>`<option>${v}</option>`).join("");
  optSize.innerHTML=p.variants.size.map(v=>`<option>${v}</option>`).join("");

  optSize.onchange=()=>updatePopupPrice();
  setTimeout(updatePopupPrice, 10);

  optionPopup.style.display="flex";
}

function closeOptionPopup(){
  optionPopup.style.display="none";
  OPT_PRODUCT=null;
}

function calculateFinalPrice(product, selectedSize){
  const basePrice = Number(product.price) || 0;

  // CHAGEE: pakai variantPricing jika tersedia
  if(CURRENT_BRAND === "chagee"){
    if(product.variantPricing && product.variantPricing.Size && product.variantPricing.Size[selectedSize]){
      return product.variantPricing.Size[selectedSize];
    }
    return basePrice;
  }

  // Default: Large +5000
  if(selectedSize === "Large") return basePrice + 5000;
  return basePrice;
}

function updatePopupPrice(){
  if(!OPT_PRODUCT || !optSize) return;

  const size = optSize.value;
  let price = calculateFinalPrice(OPT_PRODUCT, size);
  price = applyReseller(price);

  const priceBox=document.getElementById("popupPrice");
  if(priceBox) priceBox.innerText = "Rp " + price.toLocaleString("id-ID");
}

function confirmOptions(){
  if(!OPT_PRODUCT) return;

  const selectedSize = optSize ? optSize.value : "Regular";
  let finalPrice = calculateFinalPrice(OPT_PRODUCT, selectedSize);
  finalPrice = applyReseller(finalPrice);

  const item={
    id: OPT_PRODUCT.id + "-" + Date.now(),
    name: OPT_PRODUCT.name,
    basePrice: OPT_PRODUCT.price,
    finalPrice: finalPrice,
    price: finalPrice,
    size: selectedSize,
    temp: optTemp ? optTemp.value : "",
    sugar: optSugar ? optSugar.value : "",
    image: OPT_PRODUCT.image,
    qty: 1,
    brand: CURRENT_BRAND
  };

  CART.push(item);
  save("cart", CART);

  closeOptionPopup();
  updateBadge();
  updateFloatingCart();
}

/* =========================
   Cart helpers (tetap sama)
========================= */
function updateBadge(){
  const count=CART.reduce((a,b)=>a+b.qty,0);
  if(count===0){
    badge.classList.add("hidden");
    badge2.classList.add("hidden");
  }else{
    badge.classList.remove("hidden");
    badge2.classList.remove("hidden");
    badge.textContent=count;
    badge2.textContent=count;
  }
}

function updateFloatingCart(){
  if(CART.length===0){
    floatCart.style.display="none";
    return;
  }
  floatCart.style.display="block";
  floatCount.textContent=CART.reduce((a,b)=>a+b.qty,0);
  floatTotal.textContent=rupiah(CART.reduce((a,b)=>a+b.price*b.qty,0));
}

/* =========================
   Render cart page (tetap sama)
========================= */
function renderCart(){
  cartItems.innerHTML="";

  if(CART.length===0){
    cartItems.innerHTML=`<p style='color:var(--muted);padding:14px;'>Keranjang masih kosong.</p>`;
    totalPrice.innerText="Rp 0";
    buildOutletControl();
    return;
  }

  CART.forEach(item=>{
    const row=document.createElement("div");
    row.className="cart-item";
    row.innerHTML=`
      <div style="flex:1;min-width:0;">
        <div class="cart-title">${item.name}</div>
        <div class="cart-sub">${item.temp} â€¢ ${item.sugar} â€¢ ${item.size}</div>
        <div class="cart-price">${rupiah(item.price)}</div>
      </div>
      <div style="width:140px;display:flex;flex-direction:column;align-items:stretch;gap:8px;">
        <div class="qty" style="justify-content:space-between;">
          <button class="qty-btn" onclick="decQty('${item.id}')">âˆ’</button>
          <span>${item.qty}</span>
          <button class="qty-btn" onclick="incQty('${item.id}')">+</button>
        </div>
        <button class="remove-btn" onclick="removeItem('${item.id}')">Hapus</button>
      </div>
    `;
    cartItems.appendChild(row);
  });

  totalPrice.innerText = rupiah(CART.reduce((a,b)=>a+(b.price*b.qty),0));
  buildOutletControl();
}

/* =========================
   Outlet Control (Custom) (tetap sama)
========================= */
function buildOutletControl(){
  const wrap=document.getElementById("outletWrapper");
  if(!wrap) return;

  const key = "outlet_" + (CURRENT_BRAND || "default");

  // Manual outlet (input)
  if(CURRENT_OUTLETS === "manual"){
    wrap.innerHTML = `<input id="outletManualInput" class="outlet-search" placeholder="Ketik outlet manual...">`;
    const input=document.getElementById("outletManualInput");
    input.value = localStorage.getItem(key) || "";
    input.oninput = (e)=> localStorage.setItem(key, e.target.value || "");
    return;
  }

  // Outlet list (custom dropdown + search)
  if(Array.isArray(CURRENT_OUTLETS) && CURRENT_OUTLETS.length){
    const ALL = [...CURRENT_OUTLETS].sort((a,b)=>
      String(a).localeCompare(String(b), "id", { sensitivity:"base" })
    );

    let selected = localStorage.getItem(key) || ALL[0] || "";
    localStorage.setItem(key, selected);

    wrap.innerHTML = `
      <div class="outlet-box">
        <div class="outlet-selected" id="outletSelected">
          <span>${selected || "-"}</span>
          <span class="chev">â–¼</span>
        </div>
        <div class="outlet-panel">
          <input id="outletSearch" class="outlet-search" placeholder="Cari outlet...">
          <div id="outletList"></div>
        </div>
      </div>
    `;

    const selectedEl=document.getElementById("outletSelected");
    const searchEl=document.getElementById("outletSearch");
    const listEl=document.getElementById("outletList");

    function render(list){
      listEl.innerHTML="";
      list.forEach(o=>{
        const div=document.createElement("div");
        div.className="outlet-item" + (o===selected ? " active" : "");
        div.textContent=o;
        div.onclick=()=>{
          selected=o;
          localStorage.setItem(key, o);
          selectedEl.innerHTML = `<span>${o}</span><span class="chev">â–¼</span>`;
          render(list);
        };
        listEl.appendChild(div);
      });
    }

    render(ALL);

    searchEl.oninput=()=>{
      const q=(searchEl.value||"").trim().toLowerCase();
      const filtered = !q ? ALL : ALL.filter(o=>String(o).toLowerCase().includes(q));
      render(filtered);
    };

    return;
  }

  // Fallback outlet kosong
  wrap.innerHTML = `<input id="outletFallback" class="outlet-search" placeholder="Outlet...">`;
  const fb=document.getElementById("outletFallback");
  fb.value = localStorage.getItem(key) || "";
  fb.oninput = (e)=> localStorage.setItem(key, e.target.value || "");
}

/* =========================
   Cart actions (tetap sama)
========================= */
function incQty(id){
  CART=CART.map(x=>{ if(x.id===id) x.qty++; return x; });
  save("cart", CART);
  renderCart(); updateBadge(); updateFloatingCart();
}
function decQty(id){
  CART=CART.map(x=>{ if(x.id===id && x.qty>1) x.qty--; return x; });
  save("cart", CART);
  renderCart(); updateBadge(); updateFloatingCart();
}
function removeItem(id){
  CART=CART.filter(x=>x.id!==id);
  save("cart", CART);
  renderCart(); updateBadge(); updateFloatingCart();
}

/* =========================
   Checkout popup (tetap sama)
========================= */
function openPopup(){
  if(CART.length===0) return alert("Keranjang kosong!");
  const name=USERNAME||"";

  const outletKey = "outlet_" + (CURRENT_BRAND || "default");
  const outlet = (localStorage.getItem(outletKey) || "").trim();
  if(!outlet) return alert("Outlet harus diisi.");

  let txt =
    `Pesanan untuk: ${name}\n` +
    `Brand: ${(CURRENT_BRAND_DATA && CURRENT_BRAND_DATA.brand) || CURRENT_BRAND || "-"}\n` +
    `Outlet: ${outlet}\n\n`;

  CART.forEach((it,i)=>{
    txt +=
      `${i+1}. ${it.name}\n` +
      `   ${it.temp} â€¢ ${it.sugar} â€¢ ${it.size}\n` +
      `   Qty: ${it.qty} x ${rupiah(it.price)}\n` +
      `   Total: ${rupiah(it.qty * it.price)}\n\n`;
  });

  const grand=CART.reduce((a,b)=>a+b.price*b.qty,0);
  txt += `Total: ${rupiah(grand)}\n\n`;

  const notes=(cartNotes.value||"").trim();
  if(notes) txt += `Catatan:\n${notes}\n`;

  popupText.textContent=txt;
  popup.style.display="flex";
}

function closePopup(){ popup.style.display="none"; }

function sendWA(){
  const msg=popupText.textContent;
  const nomor="6281294944774"; // nomor WA reseller
  const url="https://wa.me/"+nomor+"?text="+encodeURIComponent(msg);

  window.open(url,"_blank");

  CART=[];
  save("cart", CART);

  closePopup();
  renderCart();
  updateBadge();
  updateFloatingCart();
}

/* =========================
   Init (tetap sama)
========================= */
window.addEventListener("load",()=>{
  splash.classList.remove("hidden");
  namePage.classList.add("hidden");
  brandPage.classList.add("hidden");
  productPage.classList.add("hidden");
  cartPage.classList.add("hidden");

  updateBadge();
  updateFloatingCart();

  setTimeout(()=>{
    if(USERNAME){
      splash.classList.add("hidden");
      brandPage.classList.remove("hidden");
      helloUser.textContent=USERNAME;
      helloUser2.textContent=USERNAME;
    }else{
      splash.classList.add("hidden");
      namePage.classList.remove("hidden");
    }
  },1850);
});
</script>

</body>
</html>
